@model AUTistima.Areas.Admin.Controllers.DocumentationViewModel
@{
    ViewData["Title"] = "Documenta√ß√£o T√©cnica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid py-4 doc-container">
    <!-- Header da Documenta√ß√£o (Vis√≠vel apenas na impress√£o/PDF) -->
    <div class="doc-header d-none d-print-block text-center mb-5">
        <h1 class="display-4 fw-bold" style="color: #F28B82;">AUTistima</h1>
        <h2 class="h4 text-muted">Documenta√ß√£o T√©cnica do Sistema</h2>
        <p class="small text-muted">Gerado automaticamente em @Model.GeneratedAt.ToString("dd/MM/yyyy HH:mm")</p>
        <hr />
    </div>

    <!-- Controles de Tela (Escondidos na impress√£o) -->
    <div class="d-flex justify-content-between align-items-center mb-4 d-print-none">
        <div>
            <h1 class="h3 mb-0 text-gray-800">üìö Documenta√ß√£o T√©cnica</h1>
            <p class="text-muted">Vis√£o geral da arquitetura, banco de dados e endpoints.</p>
        </div>
        <button onclick="window.print()" class="btn btn-salmon btn-lg shadow-sm">
            <i class="bi bi-file-earmark-pdf-fill me-2"></i>Gerar PDF
        </button>
    </div>

    <!-- 1. Informa√ß√µes do Sistema -->
    <section class="card shadow-sm mb-4 break-inside-avoid">
        <div class="card-header bg-light py-3">
            <h5 class="mb-0 fw-bold text-primary"><i class="bi bi-info-circle me-2"></i>Informa√ß√µes do Ambiente</h5>
        </div>
        <div class="card-body">
            <div class="row">
                @foreach (var info in Model.SystemInfo)
                {
                    <div class="col-md-6 mb-2">
                        <strong class="text-muted">@info.Key:</strong>
                        <span class="ms-2">@info.Value</span>
                    </div>
                }
            </div>
        </div>
    </section>

    <!-- 2. Banco de Dados -->
    <section class="mb-5">
        <h3 class="border-bottom pb-2 mb-4 text-secondary break-after-avoid">
            <i class="bi bi-database me-2"></i>Estrutura do Banco de Dados
        </h3>
        
        <div class="row">
            @foreach (var table in Model.DatabaseTables)
            {
                <div class="col-lg-6 mb-4 break-inside-avoid">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-header bg-white border-bottom-0 pt-3">
                            <h5 class="card-title fw-bold text-primary mb-0">
                                <i class="bi bi-table me-2"></i>@table.Name
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <table class="table table-sm table-striped mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">Coluna</th>
                                        <th>Tipo</th>
                                        <th>Detalhes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var col in table.Columns)
                                    {
                                        <tr>
                                            <td class="ps-3 font-monospace small">@col.Name</td>
                                            <td class="small">@col.Type</td>
                                            <td class="small">
                                                @if (col.IsPrimaryKey)
                                                {
                                                    <span class="badge bg-warning text-dark">PK</span>
                                                }
                                                @if (col.IsNullable)
                                                {
                                                    <span class="badge bg-light text-muted border">Null</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-light text-dark border">Not Null</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
        </div>
    </section>

    <!-- 3. Controllers e Endpoints -->
    <section class="mb-5">
        <h3 class="border-bottom pb-2 mb-4 text-secondary break-after-avoid">
            <i class="bi bi-code-square me-2"></i>Controllers & Endpoints
        </h3>

        @foreach (var controller in Model.Controllers)
        {
            <div class="card mb-4 shadow-sm break-inside-avoid">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-dark">@controller.Name</h5>
                        <small class="text-muted font-monospace">@controller.Namespace</small>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th style="width: 100px;" class="ps-3">M√©todo</th>
                                    <th>Rota / Action</th>
                                    <th>Nome</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var action in controller.Actions)
                                {
                                    <tr>
                                        <td class="ps-3">
                                            @if (action.Method == "GET")
                                            {
                                                <span class="badge bg-success bg-opacity-10 text-success border border-success">GET</span>
                                            }
                                            else if (action.Method == "POST")
                                            {
                                                <span class="badge bg-primary bg-opacity-10 text-primary border border-primary">POST</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary">@action.Method</span>
                                            }
                                        </td>
                                        <td class="font-monospace small text-muted">@action.Route</td>
                                        <td class="small fw-semibold">@action.Name</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }
    </section>
    
    <!-- Footer do PDF -->
    <div class="doc-footer d-none d-print-block text-center mt-5 pt-5 border-top">
        <p class="text-muted small">AUTistima - Documenta√ß√£o Gerada Automaticamente</p>
    </div>
</div>

<style>
    /* Estilos espec√≠ficos para impress√£o */
    @@media print {
        /* Esconde elementos da interface do sistema */
        .sidebar, .navbar, .footer, .btn, .d-print-none {
            display: none !important;
        }

        /* Ajusta o container principal */
        body, .main-content, .container-fluid {
            padding: 0 !important;
            margin: 0 !important;
            background: white !important;
            width: 100% !important;
        }

        .doc-container {
            max-width: 100% !important;
            padding: 2cm !important;
        }

        /* Tipografia para impress√£o */
        body {
            font-size: 12pt;
            color: #000;
        }

        h1, h2, h3 {
            page-break-after: avoid;
        }

        /* Cards e Tabelas */
        .card {
            border: 1px solid #ddd !important;
            box-shadow: none !important;
            break-inside: avoid;
        }

        .badge {
            border: 1px solid #000 !important;
            color: #000 !important;
            background: none !important;
        }

        /* Links */
        a {
            text-decoration: none;
            color: #000;
        }
        
        /* Quebras de p√°gina */
        .break-inside-avoid {
            page-break-inside: avoid;
        }
        
        .break-after-avoid {
            page-break-after: avoid;
        }
    }
</style>